#+TITLE: Biorgo

* template API
  #+NAME: sort
  #+BEGIN_SRC go
  {{ with sortStorg . "HOST_DATE" }}{{ end }}
  #+END_SRC

  #+NAME: filter
  #+BEGIN_SRC go
  {{ with filterStorg . "MODULE" "journal" }} {{ end }}
  #+END_SRC

  #+NAME: index
  #+BEGIN_SRC go
  {{ range $nodeIndex, $node := . }}{{ $nodeIndex }}{{ end }}
  #+END_SRC

  #+NAME: uniqueDate
  #+BEGIN_SRC go
  {{ range $nodeIndex, $node := uniqueDate . "HOST_DATE"}}{{ end }}
  #+END_SRC

  #+NAME: reached2400
  #+BEGIN_SRC go
  {{ range $nodeIndex, $node := .}}
  {{ if reached2400 $nodeIndex }}"reached node index divisible by 2400"{{ end }}
  {{ end }}
  #+END_SRC

  #+NAME: shorten
  #+BEGIN_SRC go
  {{ printf "%.50s" $node.datum.entry }}
  #+END_SRC

  #+NAME: betweenDates
  #+BEGIN_SRC go
  {{ with betweenDates . "HOST_DATE" "<2016-01-01>" "<2017-01-01>" }}{{ end }}
  #+END_SRC
* templates
** desmi complete sorted by HOST_DATE
#+BEGIN_SRC go :tangle templates/desmi-all-host-asc.tmpl
{{ range sortStorg . "HOST_DATE" }}* .
:PROPERTIES: {{ with .metadatum }}
:COMMENT: {{ with .COMMENT }}{{ . }}{{ end }}
:GUEST_DATE: {{ with .GUEST_DATE }}{{ . }}{{ end }}
:GUEST: {{ with .GUEST }}{{ . }}{{ end }}
:HOST_DATE: {{ with .HOST_DATE }} {{ . }}{{ end }}
:HOST: {{ with .HOST }}{{ . }}{{ end }}
:LABEL: {{ with .LABEL }}{{ . }}{{ end }}
:MODULE: {{ with .MODULE }}{{ . }}{{ end }}
:TYPE: {{ with .TYPE }}{{ . }}{{ end }}{{ end }}
:UUID: {{ with .datum.uuid }}{{ . }}{{ end }}
:END:
{{ with .datum.entry }}{{ . }}{{ end }}{{ end }}
#+END_SRC
** desmi complete sorted by GUEST_DATE
#+BEGIN_SRC go :tangle templates/desmi-all-guest-asc.tmpl
{{ range sortStorg . "GUEST_DATE" }}* .
:PROPERTIES: {{ with .metadatum }}
:COMMENT: {{ with .COMMENT }}{{ . }}{{ end }}
:GUEST_DATE: {{ with .GUEST_DATE }}{{ . }}{{ end }}
:GUEST: {{ with .GUEST }}{{ . }}{{ end }}
:HOST_DATE: {{ with .HOST_DATE }} {{ . }}{{ end }}
:HOST: {{ with .HOST }}{{ . }}{{ end }}
:LABEL: {{ with .LABEL }}{{ . }}{{ end }}
:MODULE: {{ with .MODULE }}{{ . }}{{ end }}
:TYPE: {{ with .TYPE }}{{ . }}{{ end }}{{ end }}
:UUID: {{ with .datum.uuid }}{{ . }}{{ end }}
:END:
{{ with .datum.entry }}{{ . }}{{ end }}{{ end }}
#+END_SRC
** dot
#+BEGIN_SRC go :tangle templates/dot.tmpl
{{ with sortStorg . "HOST_DATE" }}{{ with filterStorg . "MODULE" "journal" }}
digraph storg_timeline {
imap=yes;
node [shape="plain"];rankdir=TB;
/* date <-> versions ranks */
/* {rank=same; "1995-05-01" "Postgres95-0.01"} */

{{ range $nodeIndex, $node := . }}
{rank=same; "{{ $node.metadatum.HOST_DATE }}""{{ $nodeIndex }}"}{{ end }}

/* Dates relations */
/*"<1995-01-01>" -> */

{{ range $nodeIndex, $node := uniqueDate . "HOST_DATE"}}
{{ if reached2400 $nodeIndex }}"{{ $node.metadatum.HOST_DATE }}"
"{{ $node.metadatum.HOST_DATE }}" ->
{{ else }}"{{ $node.metadatum.HOST_DATE }}" ->{{ end }}{{ end }}
"Future"

/* Versions relations */
/*"1" [label="Postgres95-0.03"] ;*/

{{ range $nodeIndex, $node := . }}
"{{ $nodeIndex }}" [label="*",tooltip="{{ printf "%.50s" $node.datum.entry }}",href="ravdia/{{ $node.datum.uuid }}.org",target="_blank"];{{ end }}

}
{{ end }}{{ end }}
#+END_SRC
** ravdia
#+BEGIN_SRC go :tangle templates/ravdia.tmpl
,* .
:PROPERTIES: {{ with .metadatum }}
:COMMENT: {{ with .COMMENT }}{{ . }}{{ end }}
:GUEST_DATE: {{ with .GUEST_DATE }}{{ . }}{{ end }}
:GUEST: {{ with .GUEST }}{{ . }}{{ end }}
:HOST_DATE: {{ with .HOST_DATE }} {{ . }}{{ end }}
:HOST: {{ with .HOST }}{{ . }}{{ end }}
:LABEL: {{ with .LABEL }}{{ . }}{{ end }}
:MODULE: {{ with .MODULE }}{{ . }}{{ end }}
:TYPE: {{ with .TYPE }}{{ . }}{{ end }}{{ end }}
:UUID: {{ with .datum.uuid }}{{ . }}{{ end }}
:END:
{{ with .datum.entry }}{{ . }}{{ end }}
#+END_SRC

** prepare mamagpa scans
#+BEGIN_SRC go :tangle templates/prepare-mamagpa-scans.tmpl
{{ range . }}* .
:PROPERTIES:
:GUEST: mamagpa
:GUEST_DATE:
:HOST: mamagpa
:HOST_DATE:
:PATH: {{ with .path }}{{ . }}{{ end }}
:TAGS:
:END:
{{ end }}
#+END_SRC
